#!/bin/bash

################################################################################
# CONFIGURATION
################################################################################

ROOT_DIR=~/linux_training/bbb-project

declare -A folders=(
  ["01_documents"]="Personal notes, weekly planning, and explanations you write."
  ["02_resources"]="Read-only resources: PDFs, datasheets, books, articles, and reference code."
  ["03_slides"]="Slides or presentations you create during your learning journey."
  ["04_examples"]="Clean and working drivers, user apps, and final sample code."
  ["05_practice"]="Practice and experimental code â€” sandbox space for trying ideas."
  ["06_scripts"]="Reusable scripts for build, deployment, overlay compilation, etc."
  ["07_overlays"]="Device Tree source (.dts) and compiled (.dtbo) files."
  ["08_kernel"]="Kernel source setup, patch notes, and configuration-related materials."
  ["09_uBoot"]="uBoot source setup, patch notes, and configuration-related materials."
  ["10_rootfs"]="rootfs, setup notes, patches, and configurations related to BBB Debian rootfs."
  ["11_logs"]="Collected dmesg, SPI logs, boot logs, etc."
  ["12_tests"]="Test scripts or automation to validate drivers and applications."
)

################################################################################
# WHIPTAIL YES / NO / HELP (ONLY ONCE)
################################################################################

while true; do
    CHOICE=$(whiptail --title "BBB Project Setup" \
        --menu "Create root project directory?" 12 70 3 \
        "Yes"  "Create project directory structure" \
        "No"   "Exit without creating anything" \
        "Help" "Show details" \
        3>&1 1>&2 2>&3)

    case "$CHOICE" in
        Yes)
            break
            ;;
        No)
            exit 0
            ;;
        Help)
            whiptail --title "Help" --msgbox "
YES:
- Creates the root project directory:
  $ROOT_DIR

- Inside this path, all standard BeagleBone project folders
  (01_documents, 02_resources, ..., 12_tests) will be created
- README.md files will be generated automatically

Example path:
~/linux_training/bbb-project

NO:
- Exits the script
- No directories or files are created
" 20 85
            ;;
    esac
done

################################################################################
# DIRECTORY CREATION (NO MORE QUESTIONS)
################################################################################

# Create root directory
mkdir -p "$ROOT_DIR"

# Create folders and README files
for dir in "${!folders[@]}"; do
    mkdir -p "$ROOT_DIR/$dir"

    cat > "$ROOT_DIR/$dir/README.md" <<EOF
# $dir

${folders[$dir]}

> Auto-generated by \`directory.sh\`
EOF
done

# Create top-level README
cat > "$ROOT_DIR/README.md" <<EOF
# BeagleBone Black Project Workspace

This directory is a structured workspace for Linux kernel, device driver,
and embedded system development on the BeagleBone Black.

## Directory Structure

| Folder | Purpose |
|--------|---------|
$(for dir in "${!folders[@]}"; do printf "| %-12s | %s |\n" "$dir" "${folders[$dir]}"; done)

---

> Created on: $(date)
EOF

################################################################################
# DONE
################################################################################

whiptail --msgbox "Project directory structure created at:\n$ROOT_DIR" 10 70
