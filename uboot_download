#!/bin/bash

################################################################################
# CONFIGURATION
################################################################################

BASE_DIR="${HOME}/linux_training/bbb-project"
UBOOT_DIR="${BASE_DIR}/09_uBoot"
TEMP_CLONE_DIR="${BASE_DIR}/.tmp_uBoot_clone"

UBOOT_REPO="https://github.com/u-boot/u-boot.git"
UBOOT_BRANCH="v2024.01"

################################################################################
# INFO (NO USER CHOICE)
################################################################################

whiptail --title "U-Boot Setup" --infobox \
"Downloading U-Boot source...

Repository:
${UBOOT_REPO}

Branch:
${UBOOT_BRANCH}

Destination:
${UBOOT_DIR}
" 12 80

################################################################################
# U-BOOT CLONE & MERGE
################################################################################

mkdir -p "${UBOOT_DIR}"
rm -rf "${TEMP_CLONE_DIR}"
mkdir -p "${TEMP_CLONE_DIR}"

git clone --depth=1 --branch "${UBOOT_BRANCH}" \
    "${UBOOT_REPO}" "${TEMP_CLONE_DIR}" || {
    whiptail --msgbox "[✗] Failed to clone U-Boot repository." 10 60
    exit 1
}

shopt -s dotglob
cp -rT "${TEMP_CLONE_DIR}" "${UBOOT_DIR}"
shopt -u dotglob

rm -rf "${TEMP_CLONE_DIR}"

################################################################################
# DONE
################################################################################

whiptail --title "U-Boot Setup Complete" --msgbox \
"[✔] U-Boot source cloned successfully.

Destination:
${UBOOT_DIR}

Branch:
${UBOOT_BRANCH}

Temporary files cleaned up.
" 14 80
